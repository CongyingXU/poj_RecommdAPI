From 5d19ecec77b9931ff3df0f2177eda0ec105ad67e Mon Sep 17 00:00:00 2001
From: Dustin Pho <pho@fb.com>
Date: Wed, 21 Sep 2016 10:42:52 -0700
Subject: [PATCH] HBASE-16657 Expose per-region last major compaction time in
 RegionServer UI

---
 .../org/apache/hadoop/hbase/tmpl/regionserver/RegionListTmpl.jamon    | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/hbase-server/src/main/jamon/org/apache/hadoop/hbase/tmpl/regionserver/RegionListTmpl.jamon b/hbase-server/src/main/jamon/org/apache/hadoop/hbase/tmpl/regionserver/RegionListTmpl.jamon
index 6261755..9ef4bc7 100644
--- a/hbase-server/src/main/jamon/org/apache/hadoop/hbase/tmpl/regionserver/RegionListTmpl.jamon
+++ b/hbase-server/src/main/jamon/org/apache/hadoop/hbase/tmpl/regionserver/RegionListTmpl.jamon
@@ -34,6 +34,7 @@
         org.apache.hadoop.hbase.client.RegionReplicaUtil;
         org.apache.hadoop.hbase.regionserver.MetricsRegionWrapper;
         org.apache.hadoop.util.StringUtils.TraditionalBinaryPrefix;
+        org.apache.hadoop.util.StringUtils;
 </%import>
 <%if (onlineRegions != null && onlineRegions.size() > 0) %>
 
@@ -197,6 +198,7 @@
             <th>Num. Compacting KVs</th>
             <th>Num. Compacted KVs</th>
             <th>Compaction Progress</th>
+            <th>Last Major Compaction</th>
         </tr>
 
         <%for HRegionInfo r: onlineRegions %>
@@ -211,12 +213,14 @@
             }
             String displayName = HRegionInfo.getRegionNameAsStringForDisplay(r,
               regionServer.getConfiguration());
+            long now = System.currentTimeMillis();
         </%java>
             <td><a href="region.jsp?name=<% r.getEncodedName() %>"><% displayName %></a></td>
             <%if load != null %>
             <td><% load.getTotalCompactingKVs() %></td>
             <td><% load.getCurrentCompactedKVs() %></td>
             <td><% percentDone %></td>
+            <td><% StringUtils.formatTimeDiff(now, load.getLastMajorCompactionTs()) %> ago</td>
             </%if>
         </tr>
         </%for>
-- 
2.8.0-rc2

