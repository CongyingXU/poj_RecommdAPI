From accae83fd394b772c9e256097a7c2116eff69109 Mon Sep 17 00:00:00 2001
From: Mike Drob <mdrob@apache.org>
Date: Wed, 7 Jun 2017 13:55:47 -0500
Subject: [PATCH] HBASE-18176 Enforce no scala outside hbase-spark

---
 hbase-assembly/pom.xml | 16 ++++++++++++++++
 hbase-spark/pom.xml    | 12 +++++++++++-
 pom.xml                | 32 ++++++++++++++++++++++++++++++++
 3 files changed, 59 insertions(+), 1 deletion(-)

diff --git a/hbase-assembly/pom.xml b/hbase-assembly/pom.xml
index 3036b9aba5..b0e6fb8400 100644
--- a/hbase-assembly/pom.xml
+++ b/hbase-assembly/pom.xml
@@ -37,6 +37,22 @@
   </properties>
   <build>
     <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-enforcer-plugin</artifactId>
+        <executions>
+          <!-- hbase-spark is ok in the assembly -->
+          <execution>
+            <id>banned-hbase-spark</id>
+            <goals>
+              <goal>enforce</goal>
+            </goals>
+            <configuration>
+              <skip>true</skip>
+            </configuration>
+          </execution>
+        </executions>
+      </plugin>
       <!-- licensing info from our dependencies -->
       <plugin>
         <groupId>org.apache.maven.plugins</groupId>
diff --git a/hbase-spark/pom.xml b/hbase-spark/pom.xml
index 14f4877025..13ba335b91 100644
--- a/hbase-spark/pom.xml
+++ b/hbase-spark/pom.xml
@@ -629,11 +629,11 @@
                     </execution>
                 </executions>
             </plugin>
-      <!-- purposefully have jsr 305 exclusion only warn in this module -->
       <plugin>
         <groupId>org.apache.maven.plugins</groupId>
         <artifactId>maven-enforcer-plugin</artifactId>
         <executions>
+          <!-- purposefully have jsr 305 exclusion only warn in this module -->
           <execution>
             <id>banned-jsr305</id>
             <goals>
@@ -643,6 +643,16 @@
               <fail>false</fail>
             </configuration>
           </execution>
+          <!-- scala is ok in the spark modules -->
+          <execution>
+            <id>banned-scala</id>
+            <goals>
+              <goal>enforce</goal>
+            </goals>
+            <configuration>
+              <skip>true</skip>
+            </configuration>
+          </execution>
         </executions>
       </plugin>
         </plugins>
diff --git a/pom.xml b/pom.xml
index 02b8d4f8d1..2c921aa7e9 100644
--- a/pom.xml
+++ b/pom.xml
@@ -970,6 +970,38 @@
               </rules>
             </configuration>
           </execution>
+          <execution>
+            <id>banned-scala</id>
+            <goals>
+              <goal>enforce</goal>
+            </goals>
+            <configuration>
+              <rules>
+                <bannedDependencies>
+                  <excludes>
+                    <exclude>org.scala-lang:scala-library</exclude>
+                  </excludes>
+                  <message>We don't allow Scala outside of the hbase-spark module, see HBASE-13992.</message>
+                </bannedDependencies>
+              </rules>
+            </configuration>
+          </execution>
+          <execution>
+            <id>banned-hbase-spark</id>
+            <goals>
+              <goal>enforce</goal>
+            </goals>
+            <configuration>
+              <rules>
+                <bannedDependencies>
+                  <excludes>
+                    <exclude>org.apache.hbase:hbase-spark</exclude>
+                  </excludes>
+                  <message>We don't allow other modules to depend on hbase-spark, see HBASE-13992.</message>
+                </bannedDependencies>
+              </rules>
+            </configuration>
+          </execution>
         </executions>
       </plugin>
       <!-- parent-module only plugins -->
-- 
2.13.0

