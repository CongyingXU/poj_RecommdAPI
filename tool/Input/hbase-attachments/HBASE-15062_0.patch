From 48d68d640abbea3c923e19154f27c33e0d20c499 Mon Sep 17 00:00:00 2001
From: Samir Ahmic <samir@personal.com>
Date: Thu, 31 Dec 2015 16:18:51 +0100
Subject: [PATCH] HBASE-15062 IntegrationTestMTTR conditionally run some tests.

---
 .../org/apache/hadoop/hbase/mttr/IntegrationTestMTTR.java    | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/hbase-it/src/test/java/org/apache/hadoop/hbase/mttr/IntegrationTestMTTR.java b/hbase-it/src/test/java/org/apache/hadoop/hbase/mttr/IntegrationTestMTTR.java
index 437f200..d625d68 100644
--- a/hbase-it/src/test/java/org/apache/hadoop/hbase/mttr/IntegrationTestMTTR.java
+++ b/hbase-it/src/test/java/org/apache/hadoop/hbase/mttr/IntegrationTestMTTR.java
@@ -19,6 +19,7 @@
 package org.apache.hadoop.hbase.mttr;
 
 import static org.junit.Assert.assertEquals;
+import static org.junit.Assume.assumeFalse;
 
 import java.io.IOException;
 import java.util.ArrayList;
@@ -266,6 +267,15 @@ public class IntegrationTestMTTR {
 
     loadTool = null;
   }
+  
+  private static boolean tablesOnMaster() {
+    boolean ret = true;
+    String value = util.getConfiguration().get("hbase.balancer.tablesOnMaster");
+    if( value != null && value.equalsIgnoreCase("none")) {
+      ret = false;
+    }
+    return ret;
+  }
 
   @Test
   public void testRestartRsHoldingTable() throws Exception {
@@ -274,6 +284,7 @@ public class IntegrationTestMTTR {
 
   @Test
   public void testKillRsHoldingMeta() throws Exception {
+    assumeFalse(tablesOnMaster());
     run(new ActionCallable(restartMetaAction), "KillRsHoldingMeta");
   }
 
@@ -308,7 +319,6 @@ public class IntegrationTestMTTR {
         // Create and start executing a callable that will kill the servers
         Future<Boolean> monkeyFuture = executorService.submit(monkeyCallable);
 
-        // Pass that future to the timing Callables.
         Future<TimingResult> putFuture = executorService.submit(new PutCallable(monkeyFuture));
         Future<TimingResult> scanFuture = executorService.submit(new ScanCallable(monkeyFuture));
         Future<TimingResult> adminFuture = executorService.submit(new AdminCallable(monkeyFuture));
-- 
2.1.4

