From 2efd73f80cbc2b402cedd125c5f8f4419d11c34c Mon Sep 17 00:00:00 2001
From: lv zehui <magicalne@gmail.com>
Date: Sat, 22 Apr 2017 21:20:00 +0800
Subject: [PATCH] emit a warning if proxy user is configured but
 hbase.regionserver.thrift.http is not

---
 .../main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/hbase-thrift/src/main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java b/hbase-thrift/src/main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java
index 0829188..6a074fd 100644
--- a/hbase-thrift/src/main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java
+++ b/hbase-thrift/src/main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java
@@ -333,6 +333,11 @@ public class ThriftServerRunner implements Runnable {
     this.realUser = userProvider.getCurrent().getUGI();
     qop = conf.get(THRIFT_QOP_KEY);
     doAsEnabled = conf.getBoolean(THRIFT_SUPPORT_PROXYUSER, false);
+    if (doAsEnabled) {
+      if (!conf.getBoolean(USE_HTTP_CONF_KEY, false)) {
+        LOG.warn("Fail to enable the doAs feature. hbase.regionserver.thrift.http is not configured ");
+      }
+    }
     if (qop != null) {
       if (!qop.equals("auth") && !qop.equals("auth-int")
           && !qop.equals("auth-conf")) {
-- 
2.6.3
