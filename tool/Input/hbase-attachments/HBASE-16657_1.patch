From 853be4eaae49ad939c1ed127e6e8f5a2ebff9ccc Mon Sep 17 00:00:00 2001
From: Dustin Pho <pho@fb.com>
Date: Sat, 24 Sep 2016 17:53:55 -0700
Subject: [PATCH] HBASE-16657 Expose per-region last major compaction time in
 RegionServer UI

---
 .../org/apache/hadoop/hbase/tmpl/regionserver/RegionListTmpl.jamon  | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/hbase-server/src/main/jamon/org/apache/hadoop/hbase/tmpl/regionserver/RegionListTmpl.jamon b/hbase-server/src/main/jamon/org/apache/hadoop/hbase/tmpl/regionserver/RegionListTmpl.jamon
index 6261755..b24a09d 100644
--- a/hbase-server/src/main/jamon/org/apache/hadoop/hbase/tmpl/regionserver/RegionListTmpl.jamon
+++ b/hbase-server/src/main/jamon/org/apache/hadoop/hbase/tmpl/regionserver/RegionListTmpl.jamon
@@ -22,6 +22,7 @@
 </%args>
 <%import>
         java.util.*;
+        org.apache.commons.lang.time.FastDateFormat;
         org.apache.hadoop.hbase.regionserver.HRegionServer;
         org.apache.hadoop.hbase.util.Bytes;
         org.apache.hadoop.hbase.HRegionInfo;
@@ -197,6 +198,7 @@
             <th>Num. Compacting KVs</th>
             <th>Num. Compacted KVs</th>
             <th>Compaction Progress</th>
+            <th>Last Major Compaction</th>
         </tr>
 
         <%for HRegionInfo r: onlineRegions %>
@@ -211,12 +213,16 @@
             }
             String displayName = HRegionInfo.getRegionNameAsStringForDisplay(r,
               regionServer.getConfiguration());
+            long lastMajorCompactionTs = load.getLastMajorCompactionTs();
+            FastDateFormat fdf = FastDateFormat.getInstance("yyyy-MM-dd HH:mm ZZ");
+            String dateTime = fdf.format(lastMajorCompactionTs);
         </%java>
             <td><a href="region.jsp?name=<% r.getEncodedName() %>"><% displayName %></a></td>
             <%if load != null %>
             <td><% load.getTotalCompactingKVs() %></td>
             <td><% load.getCurrentCompactedKVs() %></td>
             <td><% percentDone %></td>
+            <td><% dateTime %></td>
             </%if>
         </tr>
         </%for>
-- 
2.8.0-rc2

