package calc;

import org.apache.axiom.om.OMAbstractFactory;
import org.apache.axiom.om.OMElement;
import org.apache.axiom.om.OMFactory;
import org.apache.axiom.om.OMNamespace;
import org.apache.axiom.om.OMNode;
import org.apache.axiom.soap.SOAPEnvelope;
import org.apache.axiom.soap.SOAPFactory;
import org.apache.axiom.soap.SOAPHeaderBlock;
import org.apache.axis2.AxisFault;
import org.apache.axis2.Constants;
import org.apache.axis2.wsdl.WSDLConstants;
import org.apache.axis2.addressing.EndpointReference;
import org.apache.axis2.client.OperationClient;
import org.apache.axis2.client.Options;
import org.apache.axis2.rpc.client.RPCServiceClient;
import org.apache.axis2.rpc.receivers.RPCMessageReceiver;
import org.apache.axis2.context.ConfigurationContext;
import org.apache.axis2.context.ConfigurationContextFactory;
import org.apache.axis2.context.MessageContext;
import org.apache.axis2.context.ServiceContext;
import org.apache.axis2.description.AxisOperation;
import org.apache.axis2.description.AxisService;


import javax.xml.namespace.QName;
import javax.xml.stream.FactoryConfigurationError;
import javax.xml.stream.XMLOutputFactory;
import javax.xml.stream.XMLStreamException;
import javax.xml.stream.XMLStreamWriter;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.ArrayList;

public class RPC_MyCalcClient {
	public static void main(String[] args){

		try{
			String opName="add";
			EndpointReference targetEPR = new EndpointReference("http://localhost:8080/axis2/services/RPCCalcService/");
			Options options = new Options();
			options.setTo(targetEPR);
			options.setTransportInProtocol(Constants.TRANSPORT_HTTP);
			ConfigurationContext configContext=ConfigurationContextFactory.createConfigurationContextFromFileSystem(null,null); 
			RPCServiceClient sender = new RPCServiceClient(configContext, null);
			sender.setOptions(options);
			ArrayList<Integer> arg = new ArrayList<Integer>();
			Integer a  = new Integer("100"); 
			arg.add(a);
			Integer b = new Integer("200");
			arg.add(b);

			QName opAdd = new QName("http:///xsd", "add");

			//metodo 1
			//OMElement result = sender.invokeBlocking(opAdd, arg.toArray());


			//metodo 2
			Object[] params = new Object[] { a, b };
			Class[] returnTypes = new Class[] { Integer.class };
			Object[] response = sender.invokeBlocking(opAdd, params, returnTypes);
			Integer result = (Integer) response[0];

			if (result == null) {System.out.println("Null");}
			else System.out.println("Result "+ result.toString());

		}catch(AxisFault a){a.printStackTrace();}


	}



}