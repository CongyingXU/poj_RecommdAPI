From 7c05f839db1d0b434dcef146d63405d38a1ce92c Mon Sep 17 00:00:00 2001
From: Gary Helmling <garyh@apache.org>
Date: Fri, 7 Oct 2016 12:01:46 -0700
Subject: [PATCH] HBASE-16657 addendum handle null RegionLoad

---
 .../hbase/tmpl/regionserver/RegionListTmpl.jamon      | 19 ++++++++++---------
 1 file changed, 10 insertions(+), 9 deletions(-)

diff --git a/hbase-server/src/main/jamon/org/apache/hadoop/hbase/tmpl/regionserver/RegionListTmpl.jamon b/hbase-server/src/main/jamon/org/apache/hadoop/hbase/tmpl/regionserver/RegionListTmpl.jamon
index b393137..96c3a96 100644
--- a/hbase-server/src/main/jamon/org/apache/hadoop/hbase/tmpl/regionserver/RegionListTmpl.jamon
+++ b/hbase-server/src/main/jamon/org/apache/hadoop/hbase/tmpl/regionserver/RegionListTmpl.jamon
@@ -207,18 +207,19 @@
         <%java>
             RegionLoad load = regionServer.createRegionLoad(r.getEncodedName());
             String percentDone = "";
-            if  (load != null && load.getTotalCompactingKVs() > 0) {
-            percentDone = String.format("%.2f", 100 *
-            ((float) load.getCurrentCompactedKVs() / load.getTotalCompactingKVs())) + "%";
+            String compactTime = "";
+            if  (load != null) {
+              if (load.getTotalCompactingKVs() > 0) {
+                percentDone = String.format("%.2f", 100 *
+                    ((float) load.getCurrentCompactedKVs() / load.getTotalCompactingKVs())) + "%";
+              }
+              if (load.getLastMajorCompactionTs() > 0) {
+                FastDateFormat fdf = FastDateFormat.getInstance("yyyy-MM-dd HH:mm ZZ");
+                compactTime = fdf.format(load.getLastMajorCompactionTs());
+              }
             }
             String displayName = HRegionInfo.getRegionNameAsStringForDisplay(r,
               regionServer.getConfiguration());
-            long lastMajorCompactionTs = load.getLastMajorCompactionTs();
-            String compactTime = "";
-            if (lastMajorCompactionTs > 0) {
-              FastDateFormat fdf = FastDateFormat.getInstance("yyyy-MM-dd HH:mm ZZ");
-              compactTime = fdf.format(lastMajorCompactionTs);
-            }
         </%java>
             <td><a href="region.jsp?name=<% r.getEncodedName() %>"><% displayName %></a></td>
             <%if load != null %>
-- 
2.7.4

