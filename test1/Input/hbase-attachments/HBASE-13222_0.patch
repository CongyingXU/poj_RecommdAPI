From 96c64a14b0e5758be24362b6b49eb31811d9b098 Mon Sep 17 00:00:00 2001
From: Nick Dimiduk <ndimiduk@apache.org>
Date: Thu, 12 Mar 2015 14:01:45 -0700
Subject: [PATCH] HBASE-13222 Provide means of non-destructive balancer
 inspection

---
 bin/get-balancer-status.rb | 40 ++++++++++++++++++++++++++++++++++++++++
 1 file changed, 40 insertions(+)
 create mode 100755 bin/get-balancer-status.rb

diff --git a/bin/get-balancer-status.rb b/bin/get-balancer-status.rb
new file mode 100755
index 0000000..7cdfa85
--- /dev/null
+++ b/bin/get-balancer-status.rb
@@ -0,0 +1,40 @@
+#!/usr/bin/env hbase-jruby
+#
+# Licensed to the Apache Software Foundation (ASF) under one or more
+# contributor license agreements. See the NOTICE file distributed with this
+# work for additional information regarding copyright ownership. The ASF
+# licenses this file to you under the Apache License, Version 2.0 (the
+# "License"); you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+# http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
+# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
+# License for the specific language governing permissions and limitations
+# under the License.
+
+# Prints the current balancer status
+
+include Java 
+import org.apache.hadoop.hbase.HBaseConfiguration
+import org.apache.hadoop.hbase.zookeeper.ZooKeeperWatcher
+import org.apache.hadoop.hbase.zookeeper.LoadBalancerTracker
+
+# disable debug/info logging on this script for clarity
+log_level = org.apache.log4j.Level::ERROR
+org.apache.log4j.Logger.getLogger('org.apache.hadoop.hbase').setLevel(log_level)
+org.apache.log4j.Logger.getLogger('org.apache.zookeeper').setLevel(log_level)
+
+config = HBaseConfiguration.create
+
+zk = ZooKeeperWatcher.new(config, 'balancer-status', nil)
+begin
+  lbt = LoadBalancerTracker.new(zk, nil)
+  lbt.start()
+  puts lbt.isBalancerOn()
+ensure
+  zk.close()
+end
+
-- 
1.9.3 (Apple Git-50)

