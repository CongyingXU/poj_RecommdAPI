From cda95a16c5637ed69de2d15b3084a9af89af18c9 Mon Sep 17 00:00:00 2001
From: Apekshit Sharma <appy@apache.org>
Date: Tue, 27 Sep 2016 11:46:20 -0700
Subject: [PATCH] HBASE-16720 Sort build ids in flaky dashboard.

Change-Id: Ie44c7d699486a3468c92351c0e2146151e722764
---
 dev-support/flaky-dashboard-template.html |  2 +-
 dev-support/report-flakies.py             | 12 ++++++++----
 2 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/dev-support/flaky-dashboard-template.html b/dev-support/flaky-dashboard-template.html
index 70febb4..fff7c82 100644
--- a/dev-support/flaky-dashboard-template.html
+++ b/dev-support/flaky-dashboard-template.html
@@ -91,7 +91,7 @@
     {% set failed = result[test]['failed'] %}
     {% set timeout = result[test]['timeout'] %}
     {% set hanging = result[test]['hanging'] %}
-    {% set success = all.difference(failed).difference(hanging) %}
+    {% set success = result[test]['success'] %}
     <tr>
         <td>{{ test |e }}</td>
         {% set flakyness =
diff --git a/dev-support/report-flakies.py b/dev-support/report-flakies.py
index 92b78cc..715f33e 100755
--- a/dev-support/report-flakies.py
+++ b/dev-support/report-flakies.py
@@ -190,11 +190,15 @@ for url_max_build in expanded_urls:
             if is_bad:
                 test_to_build_ids[bad_test]['bad_count'] += 1
 
-    # Calculate flakyness % for each test.
+    # Calculate flakyness % and successful builds for each test. Also sort build ids.
     for bad_test in test_to_build_ids:
-        test_to_build_ids[bad_test]['flakyness'] = (
-            (test_to_build_ids[bad_test]['bad_count']) * 100.0 /
-            len(test_to_build_ids[bad_test]['all']))
+        test_result = test_to_build_ids[bad_test]
+        test_result['flakyness'] = test_result['bad_count'] * 100.0 / len(test_result['all'])
+        test_result['success'] = (test_result['all'].difference(
+            test_result['failed'].union(test_result['hanging'])))
+        for key in ['all', 'timeout', 'failed', 'hanging', 'success']:
+            test_result[key] = sorted(test_result[key])
+
 
     # Sort tests in descending order by flakyness.
     sorted_test_to_build_ids = OrderedDict(
-- 
2.3.2 (Apple Git-55)
