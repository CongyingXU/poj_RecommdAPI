From 7f1dd2530a43685e8d6f74cb508b585689160635 Mon Sep 17 00:00:00 2001
From: Jonathan Lawlor <jonathan.lawlor@cloudera.com>
Date: Fri, 24 Apr 2015 10:27:20 -0700
Subject: [PATCH] HBASE-13552 ChoreService shutdown message could be more
 informative

---
 .../src/main/java/org/apache/hadoop/hbase/ChoreService.java         | 6 +++---
 .../src/main/java/org/apache/hadoop/hbase/ScheduledChore.java       | 6 ++++++
 2 files changed, 9 insertions(+), 3 deletions(-)

diff --git a/hbase-common/src/main/java/org/apache/hadoop/hbase/ChoreService.java b/hbase-common/src/main/java/org/apache/hadoop/hbase/ChoreService.java
index 5e2e43ea3e097fa9d30019a80c8b5abf6d011aad..17c75f86d03ac770552ff62d576dbb0a02d3e367 100644
--- a/hbase-common/src/main/java/org/apache/hadoop/hbase/ChoreService.java
+++ b/hbase-common/src/main/java/org/apache/hadoop/hbase/ChoreService.java
@@ -21,7 +21,6 @@ package org.apache.hadoop.hbase;
 import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.LinkedHashMap;
-import java.util.List;
 import java.util.Map.Entry;
 import java.util.concurrent.ScheduledFuture;
 import java.util.concurrent.ScheduledThreadPoolExecutor;
@@ -298,9 +297,10 @@ public class ChoreService implements ChoreServicer {
    * after this method has been called (i.e. future scheduling attempts will fail).
    */
   public void shutdown() {
-    List<Runnable> ongoing = scheduler.shutdownNow();
+    scheduler.shutdownNow();
     if (LOG.isInfoEnabled()) {
-      LOG.info("Chore service for: " + coreThreadPoolPrefix + " had " + ongoing + " on shutdown");
+      LOG.info("Chore service for: " + coreThreadPoolPrefix + " had " + scheduledChores.keySet()
+          + " on shutdown");
     }
     cancelAllChores(true);
     scheduledChores.clear();
diff --git a/hbase-common/src/main/java/org/apache/hadoop/hbase/ScheduledChore.java b/hbase-common/src/main/java/org/apache/hadoop/hbase/ScheduledChore.java
index 16d080b469205e46e1b131254936be5f7795c87a..8670d6061275e6a0c1d3867b1e83cde09a6f54be 100644
--- a/hbase-common/src/main/java/org/apache/hadoop/hbase/ScheduledChore.java
+++ b/hbase-common/src/main/java/org/apache/hadoop/hbase/ScheduledChore.java
@@ -338,4 +338,10 @@ public abstract class ScheduledChore implements Runnable {
    */
   protected synchronized void cleanup() {
   }
+
+  @Override
+  public String toString() {
+    return "[ScheduledChore: Name: " + getName() + " Period: " + getPeriod() + " Unit: "
+        + getTimeUnit() + "]";
+  }
 }
-- 
1.9.3 (Apple Git-50)

