From b419ad931dfb352821db6cc61dd1077004d2ac36 Mon Sep 17 00:00:00 2001
From: gjacoby <gjacoby@salesforce.com>
Date: Mon, 17 Apr 2017 16:08:25 -0700
Subject: [PATCH] HBASE-17912 - Avoid major compactions on region server
 startup

---
 .../main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java
index 41eb0a356b..c197418797 100644
--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java
+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java
@@ -1626,7 +1626,9 @@ public class HRegionServer extends HasThread implements
     private final HRegionServer instance;
     private final int majorCompactPriority;
     private final static int DEFAULT_PRIORITY = Integer.MAX_VALUE;
-    private long iteration = 0;
+    //Iteration is 1-based rather than 0-based so we don't check for compaction
+    // immediately upon region server startup
+    private long iteration = 1;
 
     CompactionChecker(final HRegionServer h, final int sleepTime,
         final Stoppable stopper) {
-- 
2.11.0

