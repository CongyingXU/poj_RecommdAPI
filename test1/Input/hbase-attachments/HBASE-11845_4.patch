From da402730587bd827a5831eff578677a3eef1666f Mon Sep 17 00:00:00 2001
From: Nick Dimiduk <ndimiduk@apache.org>
Date: Thu, 11 Sep 2014 15:45:44 -0700
Subject: [PATCH] HBASE-11845 addendum

---
 .../main/java/org/apache/hadoop/hbase/io/hfile/HFilePrettyPrinter.java | 3 +++
 .../org/apache/hadoop/hbase/regionserver/TestScanWithBloomError.java   | 2 +-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFilePrettyPrinter.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFilePrettyPrinter.java
index 569059c..ab3ac63 100644
--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFilePrettyPrinter.java
+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFilePrettyPrinter.java
@@ -196,6 +196,9 @@ public class HFilePrettyPrinter extends Configured implements Tool {
    * exit code (zero for success, non-zero for failure).
    */
   public int run(String[] args) {
+    if (getConf() == null) {
+      throw new RuntimeException("A Configuration instance must be provided.");
+    }
     try {
       FSUtils.setFsDefault(getConf(), FSUtils.getRootDir(getConf()));
       if (!parseOptions(args))
diff --git a/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestScanWithBloomError.java b/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestScanWithBloomError.java
index 54e8517..6aae6b6 100644
--- a/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestScanWithBloomError.java
+++ b/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestScanWithBloomError.java
@@ -150,7 +150,7 @@ public class TestScanWithBloomError {
     for (StoreFileScanner sfScanner : scanners)
       lastStoreFileReader = sfScanner.getReader();
 
-    new HFilePrettyPrinter().run(new String[]{ "-m", "-p", "-f",
+    new HFilePrettyPrinter(conf).run(new String[]{ "-m", "-p", "-f",
         lastStoreFileReader.getHFileReader().getPath().toString()});
 
     // Disable Bloom filter for the last store file. The disabled Bloom filter
-- 
1.9.0

