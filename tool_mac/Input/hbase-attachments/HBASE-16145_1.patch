From 76c2d3b17e5797f9e024ac1069ad30d91c161331 Mon Sep 17 00:00:00 2001
From: Konstantin Ryakhovskiy <ryakhovskiy.developer@gmail.com>
Date: Tue, 5 Jul 2016 19:51:35 +0200
Subject: [PATCH] HBASE-16145 MultiRowRangeFilter constructor does not throw
 IOException

---
 .../org/apache/hadoop/hbase/filter/MultiRowRangeFilter.java  | 12 ++----------
 .../org/apache/hadoop/hbase/rest/model/ScannerModel.java     |  6 +-----
 .../java/org/apache/hadoop/hbase/mapreduce/RowCounter.java   |  7 +------
 3 files changed, 4 insertions(+), 21 deletions(-)

diff --git a/hbase-client/src/main/java/org/apache/hadoop/hbase/filter/MultiRowRangeFilter.java b/hbase-client/src/main/java/org/apache/hadoop/hbase/filter/MultiRowRangeFilter.java
index 5f9c833..00f6314 100644
--- a/hbase-client/src/main/java/org/apache/hadoop/hbase/filter/MultiRowRangeFilter.java
+++ b/hbase-client/src/main/java/org/apache/hadoop/hbase/filter/MultiRowRangeFilter.java
@@ -17,7 +17,6 @@
  */
 package org.apache.hadoop.hbase.filter;
 
-import java.io.IOException;
 import java.util.ArrayList;
 import java.util.Collections;
 import java.util.List;
@@ -66,11 +65,8 @@ public class MultiRowRangeFilter extends FilterBase {
 
   /**
    * @param list A list of <code>RowRange</code>
-   * @throws java.io.IOException
-   *           throw an exception if the range list is not in an natural order or any
-   *           <code>RowRange</code> is invalid
    */
-  public MultiRowRangeFilter(List<RowRange> list) throws IOException {
+  public MultiRowRangeFilter(List<RowRange> list) {
     this.rangeList = sortAndMerge(list);
   }
 
@@ -184,11 +180,7 @@ public class MultiRowRangeFilter extends FilterBase {
               rangeProto.getStopRow().toByteArray() : null, rangeProto.getStopRowInclusive());
       rangeList.add(range);
     }
-    try {
-      return new MultiRowRangeFilter(rangeList);
-    } catch (IOException e) {
-      throw new DeserializationException("Fail to instantiate the MultiRowRangeFilter", e);
-    }
+    return new MultiRowRangeFilter(rangeList);
   }
 
   /**
diff --git a/hbase-rest/src/main/java/org/apache/hadoop/hbase/rest/model/ScannerModel.java b/hbase-rest/src/main/java/org/apache/hadoop/hbase/rest/model/ScannerModel.java
index 7512d3e..63a9c81 100644
--- a/hbase-rest/src/main/java/org/apache/hadoop/hbase/rest/model/ScannerModel.java
+++ b/hbase-rest/src/main/java/org/apache/hadoop/hbase/rest/model/ScannerModel.java
@@ -407,11 +407,7 @@ public class ScannerModel implements ProtobufMessageHandler, Serializable {
         filter = new MultipleColumnPrefixFilter(values);
       } break;
       case MultiRowRangeFilter: {
-        try {
-          filter = new MultiRowRangeFilter(ranges);
-        } catch (IOException e) {
-          throw new RuntimeException(e);
-        }
+        filter = new MultiRowRangeFilter(ranges);
       } break;
       case PageFilter:
         filter = new PageFilter(Long.parseLong(value));
diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/RowCounter.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/RowCounter.java
index aca84fd..47651af 100644
--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/RowCounter.java
+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/RowCounter.java
@@ -207,12 +207,7 @@ public class RowCounter extends Configured implements Tool {
       scan.setStartRow(range.getStartRow()); //inclusive
       scan.setStopRow(range.getStopRow());   //exclusive
     } else if (size > 1) {
-      try {
-        scan.setFilter(new MultiRowRangeFilter(rowRangeList));
-      } catch (IOException e) {
-        //the IOException should never be thrown. see HBASE-16145
-        throw new RuntimeException("Cannot instantiate MultiRowRangeFilter");
-      }
+      scan.setFilter(new MultiRowRangeFilter(rowRangeList));
     }
   }
 
-- 
1.8.3.1
