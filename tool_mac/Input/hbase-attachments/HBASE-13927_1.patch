From 87e7dc41e54bb3579c368e957834d5ea2091d908 Mon Sep 17 00:00:00 2001
From: Elliott Clark <eclark@apache.org>
Date: Wed, 17 Jun 2015 11:48:45 -0700
Subject: [PATCH] HBASE-13927 Allow hbase-daemon.sh to conditionally redirect
 the log or not

---
 bin/hbase-daemon.sh | 27 +++++++++++++++++++--------
 1 file changed, 19 insertions(+), 8 deletions(-)

diff --git a/bin/hbase-daemon.sh b/bin/hbase-daemon.sh
index fa5c9fd..7164bcf 100755
--- a/bin/hbase-daemon.sh
+++ b/bin/hbase-daemon.sh
@@ -202,15 +202,26 @@ case $startStop in
   ;;
 
 (foreground_start)
-    # Add to the command log file vital stats on our environment.
-    echo "`date` Starting $command on `hostname`" >> ${HBASE_LOGLOG}
-    echo "`ulimit -a`" >> "$HBASE_LOGLOG" 2>&1
-    # in case the parent shell gets the kill make sure to trap signals.
-    # Only one will get called. Either the trap or the flow will go through.
     trap cleanAfterRun SIGHUP SIGINT SIGTERM EXIT
-    nice -n $HBASE_NICENESS "$HBASE_HOME"/bin/hbase \
-        --config "${HBASE_CONF_DIR}" \
-        $command "$@" start >> ${HBASE_LOGOUT} 2>&1 &
+    if [ "$HBASE_NO_REDIRECT_LOG" != "" ]; then
+        # NO REDIRECT
+        echo "`date` Starting $command on `hostname`"
+        echo "`ulimit -a`"
+        # in case the parent shell gets the kill make sure to trap signals.
+        # Only one will get called. Either the trap or the flow will go through.
+        nice -n $HBASE_NICENESS "$HBASE_HOME"/bin/hbase \
+            --config "${HBASE_CONF_DIR}" \
+            $command "$@" start &
+    else
+        echo "`date` Starting $command on `hostname`" >> ${HBASE_LOGLOG}
+        echo "`ulimit -a`" >> "$HBASE_LOGLOG" 2>&1
+        # in case the parent shell gets the kill make sure to trap signals.
+        # Only one will get called. Either the trap or the flow will go through.
+        nice -n $HBASE_NICENESS "$HBASE_HOME"/bin/hbase \
+            --config "${HBASE_CONF_DIR}" \
+            $command "$@" start >> ${HBASE_LOGOUT} 2>&1 &
+    fi
+    # Add to the command log file vital stats on our environment.
     hbase_pid=$!
     echo $hbase_pid > ${HBASE_PID}
     wait $hbase_pid
-- 
2.4.3

