From 8eeaf30c9356dcc8b30dfbe21df85e68e0c502c3 Mon Sep 17 00:00:00 2001
From: Misty Stanley-Jones <mstanleyjones@cloudera.com>
Date: Fri, 18 Dec 2015 12:40:00 -0800
Subject: [PATCH] HBASE-13129 Add troubleshooting hints around WAL retention
 from replication

---
 src/main/asciidoc/_chapters/ops_mgt.adoc         | 7 ++++++-
 src/main/asciidoc/_chapters/troubleshooting.adoc | 3 +++
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/src/main/asciidoc/_chapters/ops_mgt.adoc b/src/main/asciidoc/_chapters/ops_mgt.adoc
index e8d44eb..ce98fef 100644
--- a/src/main/asciidoc/_chapters/ops_mgt.adoc
+++ b/src/main/asciidoc/_chapters/ops_mgt.adoc
@@ -1337,7 +1337,10 @@ list_peers:: list all replication relationships known by this cluster
 enable_peer <ID>::
   Enable a previously-disabled replication relationship
 disable_peer <ID>::
-  Disable a replication relationship. HBase will no longer send edits to that peer cluster, but it still keeps track of all the new WALs that it will need to replicate if and when it is re-enabled.
+  Disable a replication relationship. HBase will no longer send edits to that
+  peer cluster, but it still keeps track of all the new WALs that it will need
+  to replicate if and when it is re-enabled. WALs are retained when enabling or disabling
+  replication as long as peers exist.
 remove_peer <ID>::
   Disable and remove a replication relationship. HBase will no longer send edits to that peer cluster or keep track of WALs.
 enable_table_replication <TABLE_NAME>::
@@ -1476,6 +1479,8 @@ The default behavior is augmented so that if a log is past its TTL, the cleaning
 If the log is not found in any queues, the log will be deleted.
 The next time the cleaning process needs to look for a log, it starts by using its cached list.
 
+NOTE: WALs are saved when replication is enabled or disabled as long as peers exist.
+
 [[rs.failover.details]]
 ==== Region Server Failover
 
diff --git a/src/main/asciidoc/_chapters/troubleshooting.adoc b/src/main/asciidoc/_chapters/troubleshooting.adoc
index e372760..e11f1e0 100644
--- a/src/main/asciidoc/_chapters/troubleshooting.adoc
+++ b/src/main/asciidoc/_chapters/troubleshooting.adoc
@@ -864,6 +864,9 @@ WAL::
   corrupt WALs are stored in `/hbase/.logs/.corrupt/` for examination.
   If the size of any subdirectory of `/hbase/.logs/` is growing, examine the HBase
   server logs to find the root cause for why WALs are not being processed correctly.
++
+If you use replication and `/hbase/.logs/oldWALs/` is using more space than you expect,
+remember that WALs are saved when replication is disabled, as long as there are peers.
 
 *Do not* manage WALs manually via HDFS.
 
-- 
2.5.4 (Apple Git-61)

