From d01acd4f76ee2a08024fcd10ebd81fe3eca67e4a Mon Sep 17 00:00:00 2001
From: Steen Manniche <steen@manniche.net>
Date: Tue, 11 Apr 2017 17:48:50 +0200
Subject: [PATCH] HBASE-17817 add table name to output (if available) when
 removing coprocessors

---
 .../apache/hadoop/hbase/coprocessor/CoprocessorHost.java   | 14 ++++++++++++--
 1 file changed, 12 insertions(+), 2 deletions(-)

diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/CoprocessorHost.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/CoprocessorHost.java
index bdface1..d2703cf 100644
--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/CoprocessorHost.java
+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/CoprocessorHost.java
@@ -601,8 +601,18 @@ public abstract class CoprocessorHost<E extends CoprocessorEnvironment> {
       // server is configured to abort.
       abortServer(env, e);
     } else {
-      LOG.error("Removing coprocessor '" + env.toString() + "' from " +
-          "environment because it threw:  " + e,e);
+      // HBASE-17817: try to extract as much information as possible from the environment
+      //
+      if(RegionCoprocessorEnvironment.class.isAssignableFrom(env.getClass()))
+      {
+        String tableName = ((RegionCoprocessorEnvironment)env).getRegionInfo().getTable().getNameAsString();
+        LOG.error("Removing coprocessor '" + env.toString() + "' from table '"+ tableName +
+                "' because it threw:  " + e,e);
+      } else {
+        LOG.error("Removing coprocessor '" + env.toString() + "' from " +
+                "environment because it threw:  " + e,e);
+      }
+
       coprocessors.remove(env);
       try {
         shutdown(env);
-- 
2.10.1 (Apple Git-78)
